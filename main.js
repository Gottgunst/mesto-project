/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===t(i)?i:String(i)),o)}var i}e.d({},{ag:()=>K,O6:()=>N,vi:()=>H});var r=function(){function e(t){var n=t.baseUrl,r=t.headers,o=t.paths;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r,this._paths=o}var t,r;return t=e,r=[{key:"_lateralUrl",value:function(e){return e.id?this._paths[e.key]+"/"+e.id:this._paths[e.key]}},{key:"workData",value:function(e){var t=arguments.length>2?arguments[2]:void 0,n={method:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET").toUpperCase(),headers:this._headers};return t&&(n.body=JSON.stringify(t)),fetch("".concat(this._baseUrl).concat(this._lateralUrl(e)),n).then((function(e){return e.ok?e.json():Promise.reject(e)}))}}],r&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===o(i)?i:String(i)),r)}var i}var a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{formSelector:"popup__form",inputSelector:"popup__field",submitButtonSelector:"popup__submit",inactiveButtonClass:"popup__submit_disabled",errorFieldSelector:'[name="err-'};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=t,this._formsPrefs=n,this._button=this._formElement.querySelector(".popup__submit")}var t,n;return t=e,(n=[{key:"toggleButton",value:function(){var e=this._formsPrefs,t=(this._formElement,e.inactiveButtonClass);this._hasInvalidInput()?(this._button.classList.add(t),this._button.setAttribute("disabled","disabled")):(this._button.classList.remove(t),this._button.removeAttribute("disabled"))}},{key:"_isValid",value:function(e){this._formElement;var t=this._formsPrefs.errorFieldSelector,n=document.querySelector("".concat(t).concat(e.target.name,'"]'));e.target.validity.patternMismatch?n.textContent=e.target.dataset.errorMessage:e.target.validity.valid?n.textContent="":n.textContent=e.target.validationMessage,this.toggleButton()}},{key:"_hasDoubleKey",value:function(e,t){return(e.key===t&&e.key===e.target.value[e.target.value.length-1]||e.key===t&&e.key===e.target.value[e.target.value.length-2])&&(e.preventDefault(),!0)}},{key:"_isKeyValid",value:function(e){var t=this._formsPrefs.errorFieldSelector,n=document.querySelector("".concat(t).concat(e.target.name,'"]'));n.textContent=this._hasDoubleKey(e," ")?"Два пробела подряд":this._hasDoubleKey(e,"-")?"Два дефиса подряд":"",new RegExp(e.target.pattern,"gi").test(e.key)||e.preventDefault(),"Backspace"===e.key|"Delete"===e.key&&(n.textContent="")}},{key:"_hasInvalidInput",value:function(){var e=this._formElement,t=this._formsPrefs.inputSelector;return Array.from(e.querySelectorAll(".".concat(t))).some((function(e){return!e.validity.valid}))}},{key:"enableValidation",value:function(){var e=this,t=this._formElement,n=this._formsPrefs.inputSelector,r=t.querySelectorAll(".".concat(n));Array.from(r).forEach((function(t){t.addEventListener("input",(function(t){return e._isValid(t)})),"text"===t.type&&t.addEventListener("keydown",(function(t){return e._isKeyValid(t)}))}))}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===u(o)?o:String(o)),r)}var o}var c=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,n=[{key:"addArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"append",t=this.items,n=this._renderer,r=this._container;t.forEach((function(t){r[e](n(t))}))}},{key:"addItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";this._container[t](e)}}],n&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===s(o)?o:String(o)),r)}var o}var f=function(){function e(t,n){var r=n.template,o=n.cardEls,i=n.backendKeys,a=n.fn;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardObject=t,this._cardElement=document.querySelector(r).content.cloneNode(!0),this._cardEls=o,this._image=this._cardElement.querySelector(o.image),this._caption=this._cardElement.querySelector(o.caption),this._counter=this._cardElement.querySelector(o.counter),this._delButton=this._cardElement.querySelector(o.delButton),this._like=this._cardElement.querySelector(o.like),this._backendKeys=i,this._fn=a}var t,n;return t=e,(n=[{key:"getCard",value:function(){return this._gather()}},{key:"_gather",value:function(){var e=this._cardElement,t=this._caption,n=this._image,r=this._counter,o=(this._delButton,this._like,this._cardObject),i=this._backendKeys;return e.firstChild.id=o[i.id],t.textContent=o[i.caption],n.src=o[i.image],n.alt=o[i.caption],r.textContent=this._checkLikes(),this._addEvents(),e}},{key:"_checkLikes",value:function(){var e=this._cardObject,t=this._backendKeys;return e[t.counter].length>0?(e[t.counter].some((function(e){return e[t.id]===window.userData[t.id]}))&&this._like.classList.add(this._cardEls.likeActive),e[t.counter].length):""}},{key:"_likeCard",value:function(e){var t=this,n=this._cardObject,r=this._backendKeys,o=e.target.classList.toggle(this._cardEls.likeActive)?"put":"delete";this._fn.likeRequest(n[r.id],o).then((function(e){var n=e;t._counter.textContent=n.likes.length>0?n.likes.length:""})).catch((function(e){console.log(e)}))}},{key:"_addEvents",value:function(){var e=this,t=this._fn,n=this._image,r=this._delButton,o=this._like,i=this._cardObject,a=this._backendKeys;n.addEventListener("click",(function(){return t.open(i[a.image],i[a.caption])})),o.addEventListener("click",(function(t){e._likeCard(t)})),i[a.owner][a.id]===window.userData[a.id]?r.addEventListener("click",(function(e){return t.del(e)})):r.remove()}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==y(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===y(o)?o:String(o)),r)}var o}var m=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profile=t,this._request=n}var t,n;return t=e,(n=[{key:"userInfo",get:function(){var e=this._profile,t=e.nameProfile,n=e.subtitleProfile,r=e.avatarProfile;return{name:t.textContent,subtitle:n.textContent,avatar:r.src}},set:function(e){var t=this._profile,n=t.nameProfile,r=t.subtitleProfile,o=t.avatarProfile;n.textContent=e.name,r.textContent=e.about,o.src=e.avatar}},{key:"workUserInfo",value:function(e,t){var n=this._profile,r=n.nameProfile,o=n.subtitleProfile,i=n.avatarProfile;return this._request(e,t).then((function(e){var t=e.name,n=e.about,a=e.avatar;r.textContent=t,o.textContent=n,i.src=a}))}}])&&d(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},v.apply(this,arguments)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k(e);if(t){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}(this,n)}}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==w(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===w(o)?o:String(o)),r)}var o}function P(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var j=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{open:"popup_opened",close:".popup__close",flex:"popup_flexed",fixPage:"page_fixed"};S(this,e),this._popupElement=document.querySelector(t),this._style=n,this._popupElement.classList.add(this._style.flex),this._bindHandleEsc=this._handleEscape.bind(this),this._bindClose=this.closePopup.bind(this)}return P(e,[{key:"openPopup",value:function(){var e=this._style.open;this._fixPopup(!0),this._popupElement.classList.add(e),document.addEventListener("keydown",this._bindHandleEsc)}},{key:"closePopup",value:function(){var e=this._style.open;this._popupElement.classList.remove(e),document.removeEventListener("keydown",this._bindHandleEsc),this._fixPopup(!1)}},{key:"setEventListeners",value:function(){var e=this,t=this._style.close;this._popupElement.querySelectorAll(t).forEach((function(t){return t.addEventListener("mousedown",e._bindClose)}))}},{key:"_handleEscape",value:function(e){"Escape"===e.key&&this.closePopup()}},{key:"_fixPopup",value:function(e){var t=this._style.fixPage;if(e)document.body.style.top="-".concat(window.scrollY,"px"),document.body.classList.add(t);else{var n=document.body.style.top;document.body.classList.remove(t),window.scrollTo(0,-1*parseInt(n||"0")),document.body.removeAttribute("style")}}}]),e}(),q=function(e){_(n,e);var t=b(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{image:".popup__image",caption:".popup__caption"};S(this,n);for(var i=arguments.length,a=new Array(i>2?i-2:0),u=2;u<i;u++)a[u-2]=arguments[u];return(r=t.call.apply(t,[this,e].concat(a)))._style.image=o.image,r._style.caption=o.caption,r._imageEl=r._popupElement.querySelector(r._style.image),r._captionEl=r._popupElement.querySelector(r._style.caption),r}return P(n,[{key:"openPopup",value:function(e,t){var r=this._imageEl,o=this._captionEl;r.src="",o.textContent=t,r.src=e,r.alt=t,v(k(n.prototype),"openPopup",this).call(this)}}]),n}(j),C=function(e){_(n,e);var t=b(n);function n(e,r){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["Обрабатываем","Сохраняем","Выполняем","Исполняем","Загружаем","Обновляем"],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{title:".popup__title_type_del-card",wrapper:".element__wrapper",activeLike:".element__button-like_active",submit:".popup__submit"};S(this,n);for(var u=arguments.length,l=new Array(u>4?u-4:0),c=4;c<u;c++)l[c-4]=arguments[c];return(o=t.call.apply(t,[this,e].concat(l)))._request=r,o._bindGetInputValues=o._getInputValues.bind(g(o)),o._style.title=a.title,o._style.wrapper=a.wrapper,o._style.activeLike=a.activeLike,o._style.submit=a.submit,o._labelArray=i,o._titleEl=o._popupElement.querySelector(o._style.title),o._submit=o._popupElement.querySelector(o._style.submit),o}return P(n,[{key:"setEventListeners",value:function(){this._submit.form.addEventListener("submit",this._bindGetInputValues),v(k(n.prototype),"setEventListeners",this).call(this)}},{key:"_getInputValues",value:function(e){var t=this,n=this._submit,r=this._labelArray,o=this._loadStatusButton;e.preventDefault();var i=n.textContent,a=r?o(n,r):o(n);this._request(e).then((function(e){t.closePopup(),o(n,[i],a)})).catch((function(e){console.log(e),o(n,["Ошибка: ".concat(e.status)],a),setTimeout((function(){return o(n,[i],a)}),2e3)}))}},{key:"_loadStatusButton",value:function(e,t,n){if(!n){var r=0,o=Math.floor(Math.random()*t.length);return setInterval((function(){r++;var n=new Array(r%5).join(".");e.textContent=t[o]+n}),400)}clearInterval(n),e.textContent=t[0]}}]),n}(j),O=function(e){_(n,e);var t=b(n);function n(e,r,o){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{title:".popup__title_type_del-card",wrapper:".element__wrapper",activeLike:".element__button-like_active"};S(this,n);for(var u=arguments.length,l=new Array(u>4?u-4:0),c=4;c<u;c++)l[c-4]=arguments[c];return(i=t.call.apply(t,[this,e,r,o].concat(l)))._style.title=a.title,i._style.wrapper=a.wrapper,i._style.activeLike=a.activeLike,i}return P(n,[{key:"openPopup",value:function(e){var t=this._titleEl,r=this._submit,o=this._style,i=o.activeLike,a=o.wrapper;v(k(n.prototype),"openPopup",this).call(this),window.cardToDelete=e.target.closest(a),e.target.closest(a).querySelector(i)?(t.textContent="Любимую карточку?",r.textContent="Удалить"):(t.textContent="Вы уверены?",r.textContent="Да")}}]),n}(C),L={template:"#templateCard",cardEls:{image:".element__image",caption:".element__caption",counter:".element__likes-counter",delButton:".element__button-del",like:".element__button-like",likeActive:"element__button-like_active"},backendKeys:{image:"link",caption:"name",counter:"likes",id:"_id",owner:"owner"},fn:{open:function(e,t){return H.openPopup(e,t)},del:function(e){return N.openPopup(e)},likeRequest:function(e,t){return K.workData({key:"likes",id:e},t)}}},x={nameProfile:document.querySelector(".profile__name"),subtitleProfile:document.querySelector(".profile__subtitle"),avatarProfile:document.querySelector(".profile__avatar"),avatarWrapperProfile:document.querySelector(".profile__avatar-wrapper")},I={form:document.querySelector('.popup__form[name="editInfo"]'),name:document.querySelector('.popup__field[name="name"]'),subtitle:document.querySelector('.popup__field[name="subtitle"]'),button:document.querySelector('.popup__form[name="editInfo"] > .popup__submit')},A={form:document.querySelector('.popup__form[name="addImage"]'),title:document.querySelector('.popup__field[name="title"]'),url:document.querySelector('.popup__field[name="url"]'),button:document.querySelector('.popup__form[name="addImage"] > .popup__submit')},D={form:document.querySelector('.popup__form[name="changeAvatar"]'),url:document.querySelector('.popup__field[name="urlAvatar"]'),button:document.querySelector('.popup__form[name="changeAvatar"] > .popup__submit')},T=(document.querySelector('.popup__form[name="delCard"]'),document.querySelector('.popup__form[name="delCard"] > .popup__submit'),document.querySelector(".profile__button_type_edit")),B=document.querySelector(".profile__button_type_add"),K=new r({baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-25",headers:{authorization:"d709f1d7-61bc-4f4a-a795-fd13fa11ff95","Content-Type":"application/json"},paths:{user:"/users/me",avatar:"/users/me/avatar",cards:"/cards",likes:"/cards/likes"}}),R={image:new a(A.form),avatar:new a(D.form),profile:new a(I.form)},V=new c({items:[],renderer:function(e){return new f(e,L).getCard()}},".elements__grid"),U=new m(x,(function(e,t){return K.workData({key:e},"patch",t)})),M=new C("#popup-profile",(function(){return U.workUserInfo("user",{name:I.name.value,about:I.subtitle.value})}),["Переписываем","Исправляем","Меняем"]);M.setEventListeners();var F=new C("#popup-add",(function(e){return K.workData({key:"cards"},"post",{name:A.title.value,link:A.url.value}).then((function(t){V.addItem(new f(t,L).getCard()),e.target.reset(),R.image.toggleButton()}))}));F.setEventListeners();var G=new C("#popup-avatar",(function(e){return U.workUserInfo("avatar",{avatar:D.url.value}).then((function(t){e.target.reset(),R.avatar.toggleButton()}))}));G.setEventListeners();var H=new q("#popup-image");H.setEventListeners();var N=new O("#popup-delCard",(function(e){return K.workData({key:"cards",id:window.cardToDelete.id},"delete").then((function(e){window.cardToDelete.remove()}))}),["Стираем","Удаляем","Забываем"]);N.setEventListeners(),Promise.all([K.workData({key:"user"}),K.workData({key:"cards"})]).then((function(e){window.userData=e[0],U.userInfo=e[0],V.items=e[1],V.addArray()})).catch((function(e){console.log(e)})),R.image.enableValidation(),R.avatar.enableValidation(),R.profile.enableValidation(),x.avatarWrapperProfile.addEventListener("click",(function(){D.url.value=U.userInfo.avatar,G.openPopup()})),B.addEventListener("click",(function(){F.openPopup()})),T.addEventListener("click",(function(){var e=new Event("input");I.name.value=U.userInfo.name,I.subtitle.value=U.userInfo.subtitle,M.openPopup(),I.name.dispatchEvent(e),I.subtitle.dispatchEvent(e)}))})();